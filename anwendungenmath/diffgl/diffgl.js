var W;var H;var Xmin;var Xmax;var Ymin;var Ymax;var ctx;var DiffX;var DiffY;var term;var h;var x=new Array();var y=new Array();var iter=0;var initmade=false;window.onload=resizeCanvas;function ok1(){hilf=document.getElementById("x0").value;var check=pruefe_grenze(hilf);if(!check){return false}Xmin=eval(hilf);if(isNaN(Xmin)){return false}x[0]=Xmin;hilf=document.getElementById("xe").value;var check=pruefe_grenze(hilf);if(!check){return false}Xmax=eval(hilf);if(isNaN(Xmax)){return false}DiffX=Xmax-Xmin;if(DiffX<=0){return false}Ymin=document.getElementById("ymin").value;Ymax=document.getElementById("ymax").value;DiffY=Ymax-Ymin;if(DiffY<=0){return false}return true}function pruefe_grenze(a){if(a.split(",").length-1>0){return false}if(a.split(".").length-1>1){return false}if((a.length>2)&&(a.charAt(0)=="-")&&(a.charAt(1)=="0")&&(a.charAt(2)!=".")){return false}if((a.length>1)&&(a.charAt(0)=="0")&&(a.charAt(1)!=".")){return false}return true}function f(x,y){hilf=eval(term);return hilf}function resizeCanvas(){var b=document.getElementById("containercanvas");b.width=b.offsetWidth;W=b.width;if(W>400){W=400}H=W;if(initmade){resize1();zeichneKS();for(var a=0;a<=iter;a++){zeichne(x[a-1],y[a-1],x[a],y[a])}}else{init()}}function init(){initmade=true;window.addEventListener("resize",function(a){resizeCanvas()});canvas1=document.getElementById("myCanvas");resize1();ctx=canvas1.getContext("2d");reset()}function resize1(){canvas1.width=W;canvas1.height=H}function reset(){document.getElementById("Step").disabled=false;document.getElementById("Run").disabled=false;y[0]=parseFloat(document.getElementById("y0").value);h=parseFloat(document.getElementById("h").value);if(h<=0){h=0.1;document.getElementById("h").value=h}iter=0;document.getElementById("x1").innerHTML="";document.getElementById("y1").innerHTML="";document.getElementById("x2").innerHTML="";document.getElementById("y2").innerHTML="";document.getElementById("x3").innerHTML="";document.getElementById("y3").innerHTML="";document.getElementById("x4").innerHTML="";document.getElementById("y4").innerHTML="";document.getElementById("x5").innerHTML="";document.getElementById("y5").innerHTML="";term=document.getElementById("f").value;ergaenze_term();if(!ok1()){melde("Fehler bei Grenzen KS!");return}try{var a=f(x[0],y[0])}catch(b){Fehlerbehandlung();return}zeichneKS();if(isNaN(a)){melde("y' existiert nicht!");return}document.getElementById("message").innerHTML="Klick auf Run oder Step"}function dostep(){iter++;x[iter]=x[iter-1]+h;if((x[iter]<=Xmax)&&(h>1e-7)){y[iter]=rungekutta(x[iter-1],y[iter-1],h);zeichne(x[iter-1],y[iter-1],x[iter],y[iter]);schreibeWerte()}else{if(x[iter]>Xmax){melde("xe erreicht!")}if(h<=1e-7){melde("h wird zu klein!")}document.getElementById("Step").disabled=true;document.getElementById("Run").disabled=true}}function run(){while((x[iter]<=Xmax)&&(h>1e-7)){dostep()}if(h<=1e-7){melde("h wird zu klein!")}}function rungekutta(a,j,b){var i,g,e,d;var c;if(Math.abs(b)>0){i=h*f(a,j);g=h*f((a+b/2),(j+i/2));e=h*f((a+b/2),(j+g/2));d=h*f((a+b),(j+e));c=j+(i+2*g+2*e+d)/6;if(Math.abs((g-e)/(i-g))>0.1){h=0.4*h;document.getElementById("h").value=runde(h)}else{if(Math.abs(h)<0.1){h=1.1*h;document.getElementById("h").value=runde(h)}}}return c}function melde(a){document.getElementById("message").innerHTML=a;document.getElementById("Step").disabled=true;document.getElementById("Run").disabled=true}function zeichneKS(){ctx.clearRect(0,0,W,H);ctx.beginPath();ctx.strokeStyle="black";ctx.lineWidth="1";ctx.font="10px Arial";var c=row(0);ctx.moveTo(0,c);ctx.lineTo(W,c);var b=Math.floor(Xmin);var a=Math.floor(Xmax);var e=c;var l=b;if(DiffX<=20){while(l<=a){var g=col(l);ctx.moveTo(g,e+3);ctx.lineTo(g,e-3);ctx.strokeText(l,g-3,e+10);l=l+1}}l=b+5-b%5;if(DiffX>20&&DiffX<80){while(l<=a){var g=col(l);ctx.moveTo(g,e+3);ctx.lineTo(g,e-3);ctx.strokeText(l,g-5,e+10);l=l+5}}ctx.moveTo(W-5,c-5);ctx.lineTo(W,c);ctx.moveTo(W-5,c+5);ctx.lineTo(W,c);var d=col(0);ctx.moveTo(d,0);ctx.lineTo(d,H);var k=Math.floor(Ymin);var j=Math.floor(Ymax);g=d;var i=k;if(DiffY<=20){while(i<=j){if(i==0){i=i+1}e=row(i);ctx.moveTo(g-3,e);ctx.lineTo(g+3,e);ctx.strokeText(i,g-12,e+3);i=i+1}}i=k+5-k%5;if(DiffY>20&&DiffY<80){while(i<=j){if(i==0){i=i+5}e=row(i);ctx.moveTo(g-3,e);ctx.lineTo(g+3,e);ctx.strokeText(i,g-16,e+3);i=i+5}}ctx.moveTo(d-5,5);ctx.lineTo(d,0);ctx.moveTo(d+5,5);ctx.lineTo(d,0);ctx.stroke()}function zeichne(j,b,d,i){ctx.beginPath();ctx.strokeStyle="red";var a=col(j);var e=row(b);var g=col(d);var c=row(i);ctx.moveTo(a,e);ctx.lineTo(g,c);ctx.stroke()}function schreibeWerte(){var d=iter-1;var c=iter-2;var b=iter-3;var a=iter-4;if(!isNaN(x[a])){document.getElementById("x1").innerHTML="x"+a+"="+runde(x[a]);document.getElementById("y1").innerHTML="y"+a+"="+runde(y[a])}if(!isNaN(x[b])){document.getElementById("x2").innerHTML="x"+b+"="+runde(x[b]);document.getElementById("y2").innerHTML="y"+b+"="+runde(y[b])}if(!isNaN(x[c])){document.getElementById("x3").innerHTML="x"+c+"="+runde(x[c]);document.getElementById("y3").innerHTML="y"+c+"="+runde(y[c])}document.getElementById("x4").innerHTML="x"+d+"="+runde(x[d]);document.getElementById("y4").innerHTML="y"+d+"="+runde(y[d]);document.getElementById("x5").innerHTML="x"+iter+"="+runde(x[iter]);document.getElementById("y5").innerHTML="y"+iter+"="+runde(y[iter])}function col(a){return((a-Xmin)/DiffX*W)}function row(a){return((Ymax-a)/DiffY*H)}function ergaenze_term(){term=term.replace(/asin/g,"hilfa");term=term.replace(/acos/g,"hilfb");term=term.replace(/atan/g,"hilfc");term=term.replace(/sin/g,"Math.sin");term=term.replace(/cos/g,"Math.cos");term=term.replace(/tan/g,"Math.tan");term=term.replace(/hilfa/g,"Math.asin");term=term.replace(/hilfb/g,"Math.acos");term=term.replace(/hilfc/g,"Math.atan");term=term.replace(/abs/g,"Math.abs");term=term.replace(/pow/g,"Math.pow");term=term.replace(/sqrt/g,"Math.sqrt");term=term.replace(/log/g,"Math.log");term=term.replace(/ln/g,"Math.log");term=term.replace(/exp/g,"Math.ixp");term=term.replace(/e/g,"Math.E");term=term.replace(/Math.ixp/g,"Math.exp");term=term.replace(/pi/g,"Math.PI")}function runde(a){return Math.round(1000000*a)/1000000}function Fehlerbehandlung(){alert("Fehler im Funktionsterm. Bitte korrigieren.")};