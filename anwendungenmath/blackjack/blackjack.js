var dealerCards=[];var playerCards=[];dealerCards.count=0;playerCards.count=0;var deck=new Deck();var gameInProgress=false;var bet;var betInput;var money;var moneyDisplay;var message;var standButton,hitButton,newGameButton;var totalplays=0;var won=0;var tied=0;window.onload=init;function init(){for(var a=1;a<=5;a++){dealerCards[a]=new DisplayedCard("dealer"+a);dealerCards[a].cardContainer.style.display="none";playerCards[a]=new DisplayedCard("player"+a);playerCards[a].cardContainer.style.display="none"}message=document.getElementById("message");standButton=document.getElementById("standButton");hitButton=document.getElementById("hitButton");newGameButton=document.getElementById("newGameButton");moneyDisplay=document.getElementById("money");money=100;moneyDisplay.innerHTML="Fr. "+money;betInput=document.getElementById("bet");betInput.value=10;betInput.disabled=false;standButton.disabled=true;hitButton.disabled=true;newGameButton.disabled=false}function dealCard(d,a,b){var c=deck.nextCard();d.count++;if(b){d[d.count].setFaceDown()}else{d[d.count].setFaceUp()}d[d.count].setCard(c);new Effect.SlideDown(d[d.count].cardContainer,{duration:0.5,queue:"end",afterFinish:a})}function getTotal(a){var d=0;var c=false;for(var b=1;b<=a.count;b++){d+=Math.min(10,a[b].card.value);if(a[b].card.value==1){c=true}}if(d+10<=21&&c){d+=10}return d}function startGame(){if(!gameInProgress){var b=betInput.value;if(!b.match(/^[0-9]+$/)||b<1||b>money){message.innerHTML="Wettbetrag muss zwischen 1 und "+money+" liegen.<br>Korrigieren und dann Neues Spiel anklicken.";return}betInput.disabled=true;bet=Number(b);for(var a=1;a<=5;a++){playerCards[a].cardContainer.style.display="none";playerCards[a].setFaceDown();dealerCards[a].cardContainer.style.display="none";dealerCards[a].setFaceDown()}message.innerHTML="Karten werden verteilt.<br>&nbsp;";deck.shuffle();dealerCards.count=0;playerCards.count=0;dealCard(playerCards);dealCard(dealerCards);dealCard(playerCards);dealCard(dealerCards,function(){standButton.disabled=false;hitButton.disabled=false;newGameButton.disabled=true;gameInProgress=true;var d=getTotal(dealerCards);var c=getTotal(playerCards);if(d==21){if(c==21){tied++;endGame(false,"Beide haben Blackjack, aber Bank gewinnt bei Gleichstand.")}else{endGame(false,"Bank hat Blackjack.")}}else{if(c==21){endGame(true,"Sie haben Blackjack.")}else{message.innerHTML="Sie haben "+c+".  Neue Karte oder Wette gilt?<br>&nbsp;"}}},true)}}function endGame(c,b){totalplays++;if(c){money+=bet;won++}else{money-=bet}message.innerHTML=(c?"Sie haben gewonnen! ":"Sie haben leider verloren. ")+b+(money>0?"<br>Neues Spiel?":"<br>Leider besitzen Sie kein Geld mehr!");var a=totalplays-won;document.getElementById("Total").innerHTML=""+totalplays;document.getElementById("Gewonnen").innerHTML=""+won;document.getElementById("Verloren").innerHTML=""+a;document.getElementById("Gleichstand").innerHTML=""+tied;standButton.disabled=true;hitButton.disabled=true;newGameButton.disabled=true;gameInProgress=false;if(dealerCards[2].faceDown){dealerCards[2].cardContainer.style.display="none";dealerCards[2].setFaceUp();new Effect.SlideDown(dealerCards[2].cardContainer,{duration:0.5,queue:"end"})}moneyDisplay.innerHTML="Fr. "+money;if(money<=0){betInput.value="Null!"}else{if(bet>money){betInput.value=money}standButton.disabled=true;hitButton.disabled=true;newGameButton.disabled=false;betInput.disabled=false}}function dealersTurnAndEndGame(){message.innerHTML="Die Reihe ist an der Bank...<br>&nbsp;";dealerCards[2].cardContainer.style.display="none";dealerCards[2].setFaceUp();var a=function(){new Effect.SlideDown(dealerCards[dealerCards.count].cardContainer,{duration:0.5,queue:"end",afterFinish:function(){var c=getTotal(dealerCards);if(dealerCards.count<5&&c<=16){dealerCards.count++;dealerCards[dealerCards.count].setCard(deck.nextCard());dealerCards[dealerCards.count].setFaceUp();a()}else{if(c>21){endGame(true,"Bank hat 端ber 21.")}else{if(dealerCards.count==5){endGame(false,"Bank hat 5 Karten ohne Total 端ber 21.")}else{var b=getTotal(playerCards);if(b>c){endGame(true,"Sie haben "+b+". Bank hat "+c+".")}else{if(b<c){endGame(false,"Sie haben "+b+". Bank hat "+c+".")}else{tied++;endGame(false,"Gleichstand mit "+b+".")}}}}}}})};a()}function hit(){if(!gameInProgress){return}standButton.disabled=true;hitButton.disabled=true;dealCard(playerCards,function(){var a=getTotal(playerCards);if(a>21){endGame(false,"Sie haben 端ber 21!")}else{if(playerCards.count==5){endGame(true,"Sie haben 5 Karten ohne Total 端ber 21.")}else{if(a==21){dealersTurnAndEndGame()}else{message.innerHTML="Sie haben "+a+". Neue Karte oder Wette gilt?<br>&nbsp;";hitButton.disabled=false;standButton.disabled=false}}}})}function stand(){if(!gameInProgress){return}hitButton.disabled=true;standButton.disabled=true;dealersTurnAndEndGame()};