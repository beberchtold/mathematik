function init(){for(var e=1;5>=e;e++)dealerCards[e]=new DisplayedCard("dealer"+e),dealerCards[e].cardContainer.style.display="none",playerCards[e]=new DisplayedCard("player"+e),playerCards[e].cardContainer.style.display="none";message=document.getElementById("message"),standButton=document.getElementById("standButton"),hitButton=document.getElementById("hitButton"),newGameButton=document.getElementById("newGameButton"),moneyDisplay=document.getElementById("money"),money=100,moneyDisplay.innerHTML="Fr. "+money,betInput=document.getElementById("bet"),betInput.value=10,betInput.disabled=!1,standButton.disabled=!0,hitButton.disabled=!0,newGameButton.disabled=!1}function dealCard(e,n,a){var t=deck.nextCard();e.count++,a?e[e.count].setFaceDown():e[e.count].setFaceUp(),e[e.count].setCard(t),new Effect.SlideDown(e[e.count].cardContainer,{duration:.5,queue:"end",afterFinish:n})}function getTotal(e){for(var n=0,a=!1,t=1;t<=e.count;t++)n+=Math.min(10,e[t].card.value),1==e[t].card.value&&(a=!0);return 21>=n+10&&a&&(n+=10),n}function startGame(){if(!gameInProgress){var e=betInput.value;if(!e.match(/^[0-9]+$/)||1>e||e>money)return message.innerHTML="Wettbetrag muss zwischen 1 und "+money+" liegen.<br>Korrigieren und dann Neues Spiel anklicken.",new Effect.Shake("betdiv"),void 0;betInput.disabled=!0,bet=Number(e);for(var n=1;5>=n;n++)playerCards[n].cardContainer.style.display="none",playerCards[n].setFaceDown(),dealerCards[n].cardContainer.style.display="none",dealerCards[n].setFaceDown();message.innerHTML="Karten werden verteilt.<br>&nbsp;",deck.shuffle(),dealerCards.count=0,playerCards.count=0,dealCard(playerCards),dealCard(dealerCards),dealCard(playerCards),dealCard(dealerCards,function(){standButton.disabled=!1,hitButton.disabled=!1,newGameButton.disabled=!0,gameInProgress=!0;var e=getTotal(dealerCards),n=getTotal(playerCards);21==e?21==n?(tied++,endGame(!1,"Beide haben Blackjack, aber Bank gewinnt bei Gleichstand.")):endGame(!1,"Bank hat Blackjack."):21==n?endGame(!0,"Sie haben Blackjack."):message.innerHTML="Sie haben "+n+".  Neue Karte oder Wette gilt?<br>&nbsp;"},!0)}}function endGame(e,n){totalplays++,e?(money+=bet,won++):money-=bet,message.innerHTML=(e?"Sie haben gewonnen! ":"Sie haben leider verloren. ")+n+(money>0?"<br>Neues Spiel?":"<br>Leider besitzen Sie kein Geld mehr!");var a=totalplays-won;document.getElementById("Total").innerHTML=""+totalplays,document.getElementById("Gewonnen").innerHTML=""+won,document.getElementById("Verloren").innerHTML=""+a,document.getElementById("Gleichstand").innerHTML=""+tied,standButton.disabled=!0,hitButton.disabled=!0,newGameButton.disabled=!0,gameInProgress=!1,dealerCards[2].faceDown&&(dealerCards[2].cardContainer.style.display="none",dealerCards[2].setFaceUp(),new Effect.SlideDown(dealerCards[2].cardContainer,{duration:.5,queue:"end"})),new Effect.Fade(moneyDisplay,{duration:.5,queue:"end",afterFinish:function(){moneyDisplay.innerHTML="Fr. "+money,new Effect.Appear(moneyDisplay,{duration:.5,queue:"end",afterFinish:function(){0>=money?(betInput.value="Null!",new Effect.Shake(moneyDisplay)):(bet>money&&(betInput.value=money),standButton.disabled=!0,hitButton.disabled=!0,newGameButton.disabled=!1,betInput.disabled=!1)}})}})}function dealersTurnAndEndGame(){message.innerHTML="Die Reihe ist an der Bank...<br>&nbsp;",dealerCards[2].cardContainer.style.display="none",dealerCards[2].setFaceUp();var e=function(){new Effect.SlideDown(dealerCards[dealerCards.count].cardContainer,{duration:.5,queue:"end",afterFinish:function(){var n=getTotal(dealerCards);if(dealerCards.count<5&&16>=n)dealerCards.count++,dealerCards[dealerCards.count].setCard(deck.nextCard()),dealerCards[dealerCards.count].setFaceUp(),e();else if(n>21)endGame(!0,"Bank hat 端ber 21.");else if(5==dealerCards.count)endGame(!1,"Bank hat 5 Karten ohne Total 端ber 21.");else{var a=getTotal(playerCards);a>n?endGame(!0,"Sie haben "+a+". Bank hat "+n+"."):n>a?endGame(!1,"Sie haben "+a+". Bank hat "+n+"."):(tied++,endGame(!1,"Gleichstand mit "+a+"."))}}})};e()}function hit(){gameInProgress&&(standButton.disabled=!0,hitButton.disabled=!0,dealCard(playerCards,function(){var e=getTotal(playerCards);e>21?endGame(!1,"Sie haben 端ber 21!"):5==playerCards.count?endGame(!0,"Sie haben 5 Karten ohne Total 端ber 21."):21==e?dealersTurnAndEndGame():(message.innerHTML="Sie haben "+e+". Neue Karte oder Wette gilt?<br>&nbsp;",hitButton.disabled=!1,standButton.disabled=!1)}))}function stand(){gameInProgress&&(hitButton.disabled=!0,standButton.disabled=!0,dealersTurnAndEndGame())}var dealerCards=[],playerCards=[];dealerCards.count=0,playerCards.count=0;var deck=new Deck,gameInProgress=!1,bet,betInput,money,moneyDisplay,message,standButton,hitButton,newGameButton,totalplays=0,won=0,tied=0;window.onload=init;