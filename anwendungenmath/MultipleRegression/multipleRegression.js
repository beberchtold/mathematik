function mittelwert(c,a){var d=0;for(var b=1;b<=c;b++){d+=a[b]}return(d/c)}function summe_produkte(d,b,a){var e=0;for(var c=1;c<=d;c++){e+=b[c]*a[c]}return e}function abweich(e,b,d){var a=[];for(var c=1;c<=e;c++){a[c]=b[c]-d}return a}function summe_residuen(e,q,p,n,m,l,j){var o=0;for(var c=1;c<=e;c++){var k=n[c]-m*q[c]-l*p[c]-j;o=o+k*k}return o}function summe_abstaende_qua(j,s,r,p,o,n,m,k){var q=0;for(var e=1;e<=j;e++){var l=o*s[e]+n*r[e]+m*p[e]+k;q=q+l*l}return q}function f(e,d,n,m,l,k,j,i){return(e*e*m+e*d*(l-j)+e*n*k-d*d*m-d*n*i)}function g(e,d,n,m,l,k,j,i){return(e*e*j+e*d*l+e*n*(i-k)-n*n*j-d*n*m)}function h(e,d,i){return(e*e+d*d+i*i-1)}function ausgabe(a){return Math.round(10000000*a)/10000000}function J11(e,d,m,l,k,j,i){return 2*e*l+(k-i)*d+j*m}function J12(e,d,m,l,k,j,i){return e*(k-j)-2*l*d-i*m}function J13(d,c,i,e){return d*i-e*c}function J21(e,d,m,l,k,j,i){return 2*e*j+(i-k)*m+l*d}function J22(b,i,e,d){return b*d-e*i}function J23(e,d,m,l,k,j,i){return e*(i-k)-2*j*m-l*d}function J31(b){return 2*b}function J32(a){return 2*a}function J33(a){return 2*a}function detJ(a){return a[1][1]*(a[2][2]*a[3][3]-a[2][3]*a[3][2])-a[2][1]*(a[1][2]*a[3][3]-a[1][3]*a[3][2])+a[3][1]*(a[1][2]*a[2][3]-a[1][3]*a[2][2])}function rechne(){var ag=[];var af=[];var ae=[];ag[1]=parseFloat(document.getElementById("x1").value);af[1]=parseFloat(document.getElementById("y1").value);ae[1]=parseFloat(document.getElementById("z1").value);var am=1;while(!isNaN(ag[am])&&!isNaN(af[am])&&!isNaN(ae[am])){am++;var V="x"+am.toString();var T="y"+am.toString();var P="z"+am.toString();ag[am]=parseFloat(document.getElementById(V).value);af[am]=parseFloat(document.getElementById(T).value);ae[am]=parseFloat(document.getElementById(P).value)}am=am-1;document.getElementById("N").innerHTML=am;document.getElementById("Ebgl").innerHTML="";document.getElementById("Ebgl2").innerHTML="";document.getElementById("Warnung").innerHTML="";document.getElementById("xquer").innerHTML="";document.getElementById("yquer").innerHTML="";document.getElementById("zquer").innerHTML="";document.getElementById("sumqua").innerHTML="";document.getElementById("sumqua2").innerHTML="";document.getElementById("sumquaz").innerHTML="";document.getElementById("sumquaz2").innerHTML="";document.getElementById("r2").innerHTML="";if(am>2){var an=mittelwert(am,ag);var S=mittelwert(am,af);var A=mittelwert(am,ae);document.getElementById("xquer").innerHTML=ausgabe(an);document.getElementById("yquer").innerHTML=ausgabe(S);document.getElementById("zquer").innerHTML=ausgabe(A);var ai=abweich(am,ag,an);var p=abweich(am,af,S);var aa=abweich(am,ae,A);var aB=summe_produkte(am,ai,ai);var C=summe_produkte(am,ai,p);var ah=summe_produkte(am,ai,aa);var k=summe_produkte(am,p,p);var G=summe_produkte(am,p,aa);var r=summe_produkte(am,aa,aa);var aq=aB*k-(C)*(C);if(aq!=0){var aE=(ah*k-G*C)/aq;var aD=(G*aB-ah*C)/aq}else{if(aB==0){var aE=100000;var aD=0}if(k==0){var aE=0;var aD=100000}}var ax=A-aE*an-aD*S;var F=summe_residuen(am,ag,af,ae,aE,aD,ax);if(r!=0){var e=1-(F/r)}else{var e=1}var U=summe_produkte(am,ag,ag);var R=summe_produkte(am,ag,af);var O=summe_produkte(am,ag,ae);var t=summe_produkte(am,af,af);var s=summe_produkte(am,af,ae);var au=summe_produkte(am,ae,ae);var Q=R-am*an*S;var N=t-am*S*S;var M=s-am*S*A;var L=U-am*an*an;var I=O-am*an*A;var H=au-am*A*A}if(am>2){if(aB==0){document.getElementById("Ebgl").innerHTML="E: x = "+ag[1]}if(k==0){document.getElementById("Ebgl").innerHTML="E: y = "+af[1]}if(r==0){document.getElementById("Ebgl").innerHTML="E: z = "+ae[1]}if(aB*k*r!=0){document.getElementById("Ebgl").innerHTML="E: z = a*x + b*y + d<br>a = "+ausgabe(aE)+",  b = "+ausgabe(aD)+",  d = "+ausgabe(ax);document.getElementById("sumquaz").innerHTML=ausgabe(F);document.getElementById("r2").innerHTML=ausgabe(e);var aA=Math.sqrt(aE*aE+aD*aD+1);aE=aE/aA;aD=aD/aA;az=-1/aA;ax=ax/aA;var aj=summe_abstaende_qua(am,ag,af,ae,aE,aD,az,ax);document.getElementById("sumqua").innerHTML=ausgabe(aj)}}else{document.getElementById("Ebgl").innerHTML="Für die Minimalisierung der Quadrate der z-Differenzen müssen Sie mindestens drei Punkte eingeben!"}if(am>4){if(aB*k*r!=0){var ab=-1;var D=false;for(var at=1;at<50;at++){ab=ab+0.04;var E=-1;for(var ap=1;ap<50;ap++){E=E+0.04;if((1-ab*ab-E*E)>0){var m=Math.sqrt(1-ab*ab-E*E);if(!D){aE=ab;aD=E;var az=m;D=true}else{ax=-aE*an-aD*S-az*A;var ao=-ab*an-E*S-m*A;var Y=summe_abstaende_qua(am,ag,af,ae,aE,aD,az,ax);var al=summe_abstaende_qua(am,ag,af,ae,ab,E,m,ao);if(al<Y){aE=ab;aD=E;az=m}}m=-m;ax=-aE*an-aD*S-az*A;var ao=-ab*an-E*S-m*A;Y=summe_abstaende_qua(am,ag,af,ae,aE,aD,az,ax);al=summe_abstaende_qua(am,ag,af,ae,ab,E,m,ao);if(al<Y){aE=ab;aD=E;az=m}}}}var l=100;var K=100;var aw=100;var ak=1;var q=[];q[1]=[];q[2]=[];q[3]=[];while(((Math.abs(aE-l)>1e-7)||(Math.abs(aD-K)>1e-7)||(Math.abs(az-aw)>1e-7))&&(ak<100)){l=aE;K=aD;aw=az;q[1][1]=J11(aE,aD,az,Q,N,M,L);q[1][2]=J12(aE,aD,az,Q,N,L,I);q[1][3]=J13(aE,aD,M,I);q[2][1]=J21(aE,aD,az,M,L,I,H);q[2][2]=J22(aE,az,Q,M);q[2][3]=J23(aE,aD,az,Q,L,I,H);q[3][1]=J31(aE);q[3][2]=J32(aD);q[3][3]=J33(az);var ad=detJ(q);var Z=q[2][2]*q[3][3]-q[2][3]*q[3][2];var X=-q[1][2]*q[3][3]+q[1][3]*q[3][2];var W=q[1][2]*q[2][3]-q[1][3]*q[2][2];var w=-q[2][1]*q[3][3]+q[2][3]*q[3][1];var v=q[1][1]*q[3][3]-q[1][3]*q[3][1];var u=-q[1][1]*q[2][3]+q[1][3]*q[2][1];var aC=q[2][1]*q[3][2]-q[2][2]*q[3][1];var ay=-q[1][1]*q[3][2]+q[1][2]*q[3][1];var av=q[1][1]*q[2][2]-q[1][2]*q[2][1];var ar=aE-1/ad*(Z*f(aE,aD,az,Q,N,M,L,I)+X*g(aE,aD,az,Q,M,L,I,H)+W*h(aE,aD,az));var B=aD-1/ad*(w*f(aE,aD,az,Q,N,M,L,I)+v*g(aE,aD,az,Q,M,L,I,H)+u*h(aE,aD,az));var ac=az-1/ad*(aC*f(aE,aD,az,Q,N,M,L,I)+ay*g(aE,aD,az,Q,M,L,I,H)+av*h(aE,aD,az));aE=ar;aD=B;az=ac;ak++}ax=-aE*an-aD*S-az*A;Y=summe_abstaende_qua(am,ag,af,ae,aE,aD,az,ax);var o=-1/az;aE=aE*o;aD=aD*o;ax=ax*o;document.getElementById("Ebgl2").innerHTML="E: z = a*x + b*y + d<br>a = "+ausgabe(aE)+",  b = "+ausgabe(aD)+",  d = "+ausgabe(ax);document.getElementById("sumqua2").innerHTML=ausgabe(Y);if(aj-Y<-1e-8){document.getElementById("Warnung").innerHTML="Warnung! Koeffizienten gemäss Variante 2 wahrscheinlich falsch!<br><br>"}F=summe_residuen(am,ag,af,ae,aE,aD,ax);document.getElementById("sumquaz2").innerHTML=ausgabe(F)}}else{document.getElementById("Ebgl2").innerHTML="Für die Minimalisierung der Quadrate der Abstände der Punkte müssen Sie mindestens fünf Punkte eingeben!"}};