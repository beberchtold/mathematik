var W;var H;var canvas1;var ctx;n=16;m=19;EMPTY=0;WALL=1;BLOCK=2;TARGET=4;PUSHER=8;FLOOR=16;var W1;var PushI;var PushJ;var A=new Array(n);for(var i=0;i<A.length;++i){A[i]=new Array(m)}var B=new Array(n);for(var i=0;i<B.length;++i){B[i]=new Array(m)}var PushIb;var PushJb;var N=1;var Level=new Array(50);var Sol="";var nr=0;var IWall=new Image();IWall.src="iwall.gif";var IBlock=new Image();IBlock.src="iblock.gif";var IFloor=new Image();IFloor.src="ifloor.gif";var PA=new Array(3);PA[0]=new Image();PA[0].src="ipusher.gif";PA[1]=new Image();PA[1].src="ipusher1.gif";PA[2]=new Image();PA[2].src="ipusher2.gif";PA[3]=new Image();PA[3].src="ipusher3.gif";var IPusher=PA[3];var ITarget=new Image();ITarget.src="itarget.gif";var initmade=false;function resizeCanvas(){var a=document.getElementById("containercanvas");a.width=a.offsetWidth;W=a.width;if(W>418){W=418}W1=Math.floor(W/m);H=n*W1;if(initmade){resize1();zeichne()}else{init()}}function init(){initmade=true;window.addEventListener("resize",function(a){resizeCanvas()});canvas1=document.getElementById("myCanvas");resize1();ctx=canvas1.getContext("2d");document.getElementById("menuicon").addEventListener("click",menu);doClear()}function resize1(){canvas1.width=W;canvas1.height=H}function doClear(){nr=0;Sol="";document.getElementById("Zug+").disabled=true;document.getElementById("Load").disabled=true;readlevel(N)}function moveb(a){document.getElementById("Zug+").disabled=true;move(a)}function levelplus(){if(N<50){N=N+1;doClear()}}function levelminus(){if(N>1){N=N-1;doClear()}}function save(){PushIb=PushI;PushJb=PushJ;var b,a;for(b=0;b<n;b++){for(a=0;a<m;a++){B[b][a]=A[b][a]}}document.getElementById("Load").disabled=false}function doLoad(){PushI=PushIb;PushJ=PushJb;var b,a;for(b=0;b<n;b++){for(a=0;a<m;a++){A[b][a]=B[b][a]}}zeichne()}function moveby(f,e){setPusher(f,e);var d=PushI+f,c=PushJ+e;if(d<0||d>=n||c<0||c>=m||(A[d][c]&WALL)!=0){return false}if((A[d][c]&BLOCK)!=0){var a=d+f,b=c+e;if((A[a][b]&WALL)!=0||((A[a][b])&BLOCK)!=0){return false}A[a][b]|=BLOCK;paintone(a,b,W1*b,W1*a);A[d][c]^=BLOCK}A[d][c]|=PUSHER;paintone(d,c,W1*c,W1*d);A[PushI][PushJ]^=PUSHER;paintone(PushI,PushJ,W1*PushJ,W1*PushI);PushI=d;PushJ=c;return true}function setPusher(b,a){if(b<0){pa=3}else{if(b>0){pa=1}else{if(a<0){pa=0}else{if(a>0){pa=2}}}}IPusher=PA[pa]}function move(a){switch(a){case"u":moveby(-1,0);break;case"d":moveby(1,0);break;case"l":moveby(0,-1);break;case"r":moveby(0,1);break}if(finished()){document.getElementById("message").innerHTML="Problem "+N+": Ziel erreicht!"}}function keyPress(a){switch(a){default:break;case 37:document.getElementById("Zug+").disabled=true;move("l");break;case 38:document.getElementById("Zug+").disabled=true;move("u");break;case 39:document.getElementById("Zug+").disabled=true;move("r");break;case 40:document.getElementById("Zug+").disabled=true;move("d");break}}function finished(){var b,a;for(b=0;b<n;b++){for(a=0;a<m;a++){if((A[b][a]&BLOCK)!=0&&(A[b][a]&TARGET)==0){return false}}}return true}function readlevel(a){try{N=a;nr=0;read(Level[N]);document.getElementById("message").innerHTML="Problem "+N}catch(b){document.getElementById("message").innerHTML=="Read_Error";return}zeichne()}function read(f){try{var a=f.split("\n");var d,b;for(d=0;d<n;d++){for(b=0;b<m;b++){var h=EMPTY;switch(a[d].charAt(b)){case"1":h=WALL;break;case"K":h=BLOCK;break;case"N":h=BLOCK|TARGET;break;case"S":h=PUSHER;PushI=d;PushJ=b;break;case"3":h=TARGET;break}A[d][b]=h}}}catch(g){document.getElementById("message").innerHTML="Level Error!"}if(PushI>0&&PushJ>0){mark(PushI,PushJ)}}function zeichne(){ctx.clearRect(0,0,W,H);var b,a;for(b=0;b<n;b++){for(a=0;a<m;a++){paintone(b,a,a*W1,b*W1)}}}function paintone(d,b,f,e){var a=A[d][b];if(a==EMPTY){return}if((a&WALL)!=0){if(IWall==null){ctx.beginPath();ctx.drawRect(f,e,W1-1,W1-1);ctx.fillStyle="red";ctx.fill();ctx.beginPath();ctx.strokeStyle="black";ctx.drawRect(f,e,W1-1,W1-1);ctx.stroke()}else{ctx.drawImage(IWall,f,e,W1,W1)}}else{if((a&FLOOR)!=0&&IFloor!=null){if(IFloor==null){ctx.beginPath();ctx.drawRect(f+1,e+1,W1-2,W1-2);ctx.fillStyle="gray";ctx.fill()}else{ctx.drawImage(IFloor,f,e,W1,W1)}}if((a&TARGET)!=0){if(ITarget==null){ctx.beginPath();ctx.drawRect(f+1,e+1,W1-2,W1-2);ctx.fillStyle="green";ctx.fill()}else{ctx.drawImage(ITarget,f,e,W1,W1)}}if((a&PUSHER)!=0){if(IPusher==null){ctx.beginPath();ctx.strokeStyle="black";drawLine(f+W1/2,e,f+W1/2,e+W1-1);drawLine(f,e+W1/2,f+W1-1,e+W1/2);ctx.stroke()}else{ctx.drawImage(IPusher,f,e,W1,W1)}}else{if((a&BLOCK)!=0){if(IBlock==null){ctx.beginPath();ctx.drawRect(f+2,e+2,W1-5,W1-5);ctx.fillStyle="blue";ctx.fill();ctx.beginPath();ctx.strokeStyle="black";ctx.drawRect(f+2,e+2,W1-5,W1-5);ctx.stroke()}else{ctx.drawImage(IBlock,f,e,W1,W1)}}}}}function mark(b,a){if(b<0||b>=m||a<0||a>=m||(A[b][a]&WALL)!=0||(A[b][a]&FLOOR)!=0){return}A[b][a]|=FLOOR;mark(b+1,a);mark(b-1,a);mark(b,a-1);mark(b,a+1)}function solution(){doClear();readsolution(N);Sol=Sol.toLowerCase();document.getElementById("Zug+").disabled=false}function zugplus(){if(nr<Sol.length){move(Sol.charAt(nr));var a=nr+1;document.getElementById("message").innerHTML="Lösung "+N+": Zugnr "+a;nr++}if(nr==Sol.length){document.getElementById("message").innerHTML="Lösung "+N+": Ziel erreicht!"}}function menu(){var a=window.open("/menu_js.html","Menu","width=300,height=520,left=100,top=100");a.focus()}Level[1]="                   \n                   \n                   \n    11111          \n    1   1          \n    1K  1          \n  111  K11         \n  1  K K 1         \n111 1 11 1   111111\n1   1 11 11111  331\n1 K  K          331\n11111 111 1S11  331\n    1     111111111\n    1111111        \n                   \n                   \n";