function resizeCanvas(){var e=document.getElementById("containercanvas");e.width=e.offsetWidth,W=e.width,W>418&&(W=418),W1=Math.floor(W/m),H=n*W1,initmade?(resize1(),zeichne()):init()}function init(){initmade=!0,window.addEventListener("resize",function(){resizeCanvas()}),canvas1=document.getElementById("myCanvas"),resize1(),ctx=canvas1.getContext("2d"),doClear()}function resize1(){canvas1.width=W,canvas1.height=H}function doClear(){nr=0,Sol="",document.getElementById("Zug+").disabled=!0,document.getElementById("Load").disabled=!0,readlevel(N)}function moveb(e){document.getElementById("Zug+").disabled=!0,move(e)}function levelplus(){50>N&&(N+=1,doClear())}function levelminus(){N>1&&(N-=1,doClear())}function save(){PushIb=PushI,PushJb=PushJ;var e,t;for(e=0;n>e;e++)for(t=0;m>t;t++)B[e][t]=A[e][t];document.getElementById("Load").disabled=!1}function doLoad(){PushI=PushIb,PushJ=PushJb;var e,t;for(e=0;n>e;e++)for(t=0;m>t;t++)A[e][t]=B[e][t];zeichne()}function moveby(e,t){setPusher(e,t);var r=PushI+e,a=PushJ+t;if(0>r||r>=n||0>a||a>=m||0!=(A[r][a]&WALL))return!1;if(0!=(A[r][a]&BLOCK)){var c=r+e,i=a+t;if(0!=(A[c][i]&WALL)||0!=(A[c][i]&BLOCK))return!1;A[c][i]|=BLOCK,paintone(c,i,W1*i,W1*c),A[r][a]^=BLOCK}return A[r][a]|=PUSHER,paintone(r,a,W1*a,W1*r),A[PushI][PushJ]^=PUSHER,paintone(PushI,PushJ,W1*PushJ,W1*PushI),PushI=r,PushJ=a,!0}function setPusher(e,n){0>e?pa=3:e>0?pa=1:0>n?pa=0:n>0&&(pa=2),IPusher=PA[pa]}function move(e){switch(e){case"u":moveby(-1,0);break;case"d":moveby(1,0);break;case"l":moveby(0,-1);break;case"r":moveby(0,1)}finished()&&(document.getElementById("message").innerHTML="Problem "+N+": Ziel erreicht!")}function keyPress(e){switch(e){default:break;case 37:document.getElementById("Zug+").disabled=!0,move("l");break;case 38:document.getElementById("Zug+").disabled=!0,move("u");break;case 39:document.getElementById("Zug+").disabled=!0,move("r");break;case 40:document.getElementById("Zug+").disabled=!0,move("d")}}function finished(){var e,t;for(e=0;n>e;e++)for(t=0;m>t;t++)if(0!=(A[e][t]&BLOCK)&&0==(A[e][t]&TARGET))return!1;return!0}function readlevel(e){try{N=e,nr=0,read(Level[N]),document.getElementById("message").innerHTML="Problem "+N}catch(n){return"Read_Error"==document.getElementById("message").innerHTML,void 0}zeichne()}function read(e){try{var t,r,a=e.split("\n");for(t=0;n>t;t++)for(r=0;m>r;r++){var c=EMPTY;switch(a[t].charAt(r)){case"1":c=WALL;break;case"K":c=BLOCK;break;case"N":c=BLOCK|TARGET;break;case"S":c=PUSHER,PushI=t,PushJ=r;break;case"3":c=TARGET}A[t][r]=c}}catch(i){document.getElementById("message").innerHTML="Level Error!"}PushI>0&&PushJ>0&&mark(PushI,PushJ)}function zeichne(){ctx.clearRect(0,0,W,H);var e,t;for(e=0;n>e;e++)for(t=0;m>t;t++)paintone(e,t,t*W1,e*W1)}function paintone(e,n,t,r){var a=A[e][n];a!=EMPTY&&(0!=(a&WALL)?null==IWall?(ctx.beginPath(),ctx.drawRect(t,r,W1-1,W1-1),ctx.fillStyle="red",ctx.fill(),ctx.beginPath(),ctx.strokeStyle="black",ctx.drawRect(t,r,W1-1,W1-1),ctx.stroke()):ctx.drawImage(IWall,t,r,W1,W1):(0!=(a&FLOOR)&&null!=IFloor&&(null==IFloor?(ctx.beginPath(),ctx.drawRect(t+1,r+1,W1-2,W1-2),ctx.fillStyle="gray",ctx.fill()):ctx.drawImage(IFloor,t,r,W1,W1)),0!=(a&TARGET)&&(null==ITarget?(ctx.beginPath(),ctx.drawRect(t+1,r+1,W1-2,W1-2),ctx.fillStyle="green",ctx.fill()):ctx.drawImage(ITarget,t,r,W1,W1)),0!=(a&PUSHER)?null==IPusher?(ctx.beginPath(),ctx.strokeStyle="black",drawLine(t+W1/2,r,t+W1/2,r+W1-1),drawLine(t,r+W1/2,t+W1-1,r+W1/2),ctx.stroke()):ctx.drawImage(IPusher,t,r,W1,W1):0!=(a&BLOCK)&&(null==IBlock?(ctx.beginPath(),ctx.drawRect(t+2,r+2,W1-5,W1-5),ctx.fillStyle="blue",ctx.fill(),ctx.beginPath(),ctx.strokeStyle="black",ctx.drawRect(t+2,r+2,W1-5,W1-5),ctx.stroke()):ctx.drawImage(IBlock,t,r,W1,W1))))}function mark(e,n){0>e||e>=m||0>n||n>=m||0!=(A[e][n]&WALL)||0!=(A[e][n]&FLOOR)||(A[e][n]|=FLOOR,mark(e+1,n),mark(e-1,n),mark(e,n-1),mark(e,n+1))}function solution(){doClear(),readsolution(N),Sol=Sol.toLowerCase(),document.getElementById("Zug+").disabled=!1}function zugplus(){if(nr<Sol.length){move(Sol.charAt(nr));var e=nr+1;document.getElementById("message").innerHTML="Lösung "+N+": Zugnr "+e,nr++}nr==Sol.length&&(document.getElementById("message").innerHTML="Lösung "+N+": Ziel erreicht!")}var W,H,canvas1,ctx;n=16,m=19,EMPTY=0,WALL=1,BLOCK=2,TARGET=4,PUSHER=8,FLOOR=16;for(var W1,PushI,PushJ,A=new Array(n),i=0;i<A.length;++i)A[i]=new Array(m);for(var B=new Array(n),i=0;i<B.length;++i)B[i]=new Array(m);var PushIb,PushJb,N=1,Level=new Array(50),Sol="",nr=0,IWall=new Image;IWall.src="iwall.gif";var IBlock=new Image;IBlock.src="iblock.gif";var IFloor=new Image;IFloor.src="ifloor.gif";var PA=new Array(3);PA[0]=new Image,PA[0].src="ipusher.gif",PA[1]=new Image,PA[1].src="ipusher1.gif",PA[2]=new Image,PA[2].src="ipusher2.gif",PA[3]=new Image,PA[3].src="ipusher3.gif";var IPusher=PA[3],ITarget=new Image;ITarget.src="itarget.gif";var initmade=!1;Level[1]="                   \n                   \n                   \n    11111          \n    1   1          \n    1K  1          \n  111  K11         \n  1  K K 1         \n111 1 11 1   111111\n1   1 11 11111  331\n1 K  K          331\n11111 111 1S11  331\n    1     111111111\n    1111111        \n                   \n                   \n";