function resizeCanvas(){var e=document.getElementById("containercanvas");e.width=e.offsetWidth,W=e.width,W>400&&(W=400),H=W,cellw=Math.floor(W/9),initmade?(resize1(),zeichne()):init()}function init(){initmade=!0,window.addEventListener("resize",function(){resizeCanvas()}),canvas1=document.getElementById("myCanvas"),canvas1.addEventListener("click",function(e){var r=getMousePos(canvas1,e),o=r.x,t=r.y;xNew=Math.floor(o/cellw),yNew=Math.floor(t/cellw),0>xNew||0>yNew||xNew>8||yNew>8||(getInfo(),zeichne())},!1),resize1(),ctx=canvas1.getContext("2d"),initPuzzle()}function initPuzzle(){aktiviere_zifferbuttons();for(var e=0;9>e;e++)for(var r=0;9>r;r++){sol[e][r]=" ",locked[e][r]=!1;for(var o=0;9>o;o++)forbidden[e][r][o]=!1}document.getElementById("Show").checked=!1,document.getElementById("Hilfe").checked=!1,hilfebuttons_bgweiss(),deaktiviere_hilfebuttons(),backIndex=0,xNew=0,yNew=0,comp=!1,unloesbar=!1,help=!1,create||(document.getElementById("message").innerHTML="Viel Erfolg!"),streiche(0)}function resize1(){canvas1.width=W,canvas1.height=H}function OnChangeCheckbox1(e){help=e.checked,getInfo()}function OnChangeCheckbox2(e){var r,o;if(e.checked)aktiviere_hilfebuttons();else{for(deaktiviere_hilfebuttons(),r=0;9>r;r++)for(o=0;9>o;o++)help1[r][o]=!1;zeichne()}}function streiche(e){var r,o,t,n;for(c=String.fromCharCode(48+e),r=0;9>r;r++)for(o=0;9>o;o++)help1[r][o]=!1;if(e>0)for(r=0;9>r;r++)for(o=0;9>o;o++)if(" "!=sol[r][o]&&(help1[r][o]=!0),sol[r][o]==c){for(t=0;9>t;t++)help1[t][o]=!0,help1[r][t]=!0;var i=3*Math.floor(r/3),a=3*Math.floor(o/3);for(t=i;i+3>t;t++)for(n=a;a+3>n;n++)help1[t][n]=!0}zeichne()}function lock(){for(var e=0;9>e;e++)for(var r=0;9>r;r++)locked[e][r]=" "!=sol[e][r];zeichne()}function zeichne(){ctx.clearRect(0,0,W,H),ctx.font="20px Arial";for(var e=0;9>e;e++)for(var r=0;9>r;r++)ctx.fillStyle="white",help1[e][r]&&(ctx.fillStyle="LightGreen"),e==xNew&&r==yNew&&(ctx.fillStyle="cyan"),ctx.rect(cellw*e,cellw*r,cellw,cellw),ctx.fill(),ctx.stroke(),ctx.beginPath(),ctx.strokeStyle="black",ctx.rect(cellw*e,cellw*r,cellw,cellw),ctx.stroke(),ctx.beginPath(),r%3==0&&line(0,cellw*r+1,9*cellw,cellw*r+1),e%3==0&&line(cellw*e+1,0,cellw*e+1,9*cellw),ctx.stroke(),ctx.beginPath(),ctx.fillStyle=locked[e][r]?"red":"black",ctx.fillText(""+sol[e][r],cellw*e+cellw/2-6,cellw*r+cellw/2+8),ctx.stroke()}function proof(e,r,o){for(var t=0;9>t;t++)if(sol[t][r]==o)return!1;for(var n=0;9>n;n++)if(sol[e][n]==o)return!1;for(var i=3*Math.floor(e/3),a=3*Math.floor(r/3),t=i;i+3>t;t++)for(var n=a;a+3>n;n++)if(sol[t][n]==o)return!1;return!0}function possibilities(e,r){var o="";if(locked[e][r])return"       ";for(var t=0;9>t;t++)proof(e,r,String.fromCharCode(49+t))&&(""!=o&&(o+=","),o+=String.fromCharCode(49+t));return o}function count(e,r){var o=0;if(locked[e][r]&&!comp)return 0;if(" "!=sol[e][r]&&comp)return 0;for(var t=0;9>t;t++)comp?proof(e,r,String.fromCharCode(49+t))&&!forbidden[e][r][t]&&o++:proof(e,r,String.fromCharCode(49+t))&&o++;return o}function eingabe(e){var r=e+48;setvalue(xNew,yNew,String.fromCharCode(r))&&(document.getElementById("Hilfe").checked&&(streiche(r-48),hilfebuttons_bgweiss(),document.getElementById("H"+e).style.backgroundColor="LightGreen"),zeichne(),getInfo(),solved()&&(document.getElementById("message").innerHTML="Gratuliere!"))}function hilf(e){var r=e+48;streiche(r-48),hilfebuttons_bgweiss(),document.getElementById("H"+e).style.backgroundColor="LightGreen",zeichne()}function keyPress(e){switch(e){case 40:8>yNew&&(yNew++,getInfo());break;case 38:yNew>0&&(yNew--,getInfo());break;case 39:8>xNew&&(xNew++,getInfo());break;case 37:xNew>0&&(xNew--,getInfo());break;default:if(c=String.fromCharCode(e),(e>57||49>e)&&" "!=c)return;setvalue(xNew,yNew,c)&&(document.getElementById("Hilfe").checked&&(streiche(e-48),hilfebuttons_bgweiss(),document.getElementById("H"+c).style.backgroundColor="LightGreen",getInfo()),solved()&&(document.getElementById("message").innerHTML="Gratuliere!"))}zeichne()}function setvalue(e,r,o){var t=o.charCodeAt(0);return 49>t||t>57?!1:locked[e][r]?!1:comp&&" "!=sol[e][r]?!1:forbidden[e][r][parseInt(o)-1]?!1:proof(e,r,o)?(xCur=e,yCur=r,xNew=e,yNew=r,back[backIndex]=9*xCur+yCur,backIndex++,sol[xCur][yCur]=o,comp&&(forbidden[xCur][yCur][parseInt(o)-1]=!0),!0):!1}function getrow(e){return Math.floor(e%9)}function getcol(e){return Math.floor(e/9)}function getcell(e,r){return 9*e+r}function possible_move(){for(var e=0;9>e;e++)for(var r=0;9>r;r++)if(" "==sol[e][r]&&0==count(e,r))return!1;return!0}function setting(){var e=0,r=-1,o=-1,t=!1,n=!1;if(!solved()&&!unloesbar){comp=!0,possible_move()||backtrack();for(var i=0;9>i;i++)for(var a=0;9>a;a++){var l=count(i,a);1==l&&(t=!0,r=i,o=a,i=9,a=9)}if(!t)for(var i=0;9>i;i++)for(var a=0;9>a;a++){var l=count(i,a);2!=l||t||(t=!0,r=i,o=a,i=9,a=9)}if(!t)for(var i=0;9>i;i++)for(var a=0;9>a;a++){var l=count(i,a);3!=l||t||(t=!0,r=i,o=a,i=9,a=9)}var c=0,f=0;do{if(!t){do f=rand(81);while(" "!=sol[getcol(f)][getrow(f)]);r=getcol(f),o=getrow(f)}e=0;do forbidden[r][o][e]||(n=setvalue(r,o,String.fromCharCode(49+e))),e++;while(9>e&&!n);t=!1,c++}while(!n&&500>c);return 500==c?(unloesbar=!0,void 0):void 0}}function anzleere(){for(var e=0,r=0;9>r;r++)for(var o=0;9>o;o++)" "==sol[r][o]&&e++;return e}function solved(){for(var e=0;9>e;e++)for(var r=0;9>r;r++)if(" "==sol[e][r])return!1;return!0}function create1(){var e,r,o=new Array(9);for(comp=!0,initPuzzle(),o=permutation(),e=0;9>e;e++)setvalue(Math.floor(e%3),Math.floor(e/3),String.fromCharCode(49+o[e]));for(o=permutation(),e=0;9>e;e++)setvalue(3+Math.floor(e%3),3+Math.floor(e/3),String.fromCharCode(49+o[e]));for(o=permutation(),e=0;9>e;e++)setvalue(6+Math.floor(e%3),6+Math.floor(e/3),String.fromCharCode(49+o[e]));r=dosolve()}function permutation(){var e,r=9,o=new Array(r);o[0]=Math.floor(r*Math.random());for(var t=1;r>t;){for(o[t]=Math.floor(r*Math.random()),e=0;t>e;e++)o[t]==o[e]&&(e=t+1);e==t&&t++}return o}function speichern_in_prob(){for(var e=0;9>e;e++)for(var r=0;9>r;r++)prob[e][r]=sol[e][r]}function eindeutig(){var e,r,o,t;save(),e=dosolve(),speichern_in_prob(),load(),trials=0;do{e=!1;for(var n=0;9>n;n++)for(var i=0;9>i;i++)if(count(n,i)>1)for(r=n,o=i,t=0;9>t;t++)t==parseInt(prob[r][o])-1&&t++,setvalue(r,o,String.fromCharCode(49+t))&&(locked[r][o]=!0,e=dosolve(),e?(speichern_in_prob(),load(),setvalue(r,o,String.fromCharCode(49+t)),t=9,n=9,i=9,save()):(unloesbar=!1,load()));trials++}while(e&&10>trials)}function docreate(){setTimeout(function(){docreate1()},10);document.getElementById("wahl").selectedIndex="0",document.getElementById("message").innerHTML="Geduld! Falls fertig, erscheint hier die Anzahl Zeichen"}function docreate1(){var e,r,o,t;create=!0,create1(),save_user();var n=0;do{load_user(),e=0;do{var i=rand(81);if(o=getcol(i),t=getrow(i)," "!=sol[o][t]){for(sol[o][t]=" ",r=0;9>r;r++)forbidden[o][t][r]=!1;e++}}while(55>e);eindeutig(),n++}while(anzleere()<51&&20>n);save_user(),create=!1,comp=!1;var e=81-anzleere();20>n?(document.getElementById("message").innerHTML=""+e+" Zeichen",zeichne()):document.getElementById("message").innerHTML="Create nicht gelungen! Klicken Sie nochmals auf Create"}function solvebutton(){if(deaktiviere_zifferbuttons(),!solved()){lock();var e=dosolve();e?(document.getElementById("message").innerHTML="Gelöst!",zeichne()):"zu wenig Zahlen"==document.getElementById("message").innerHTML||(document.getElementById("message").innerHTML="unlösbar!")}}function dosolve(){if(solved())return!0;var e=!1;if(anzleere()>64)return document.getElementById("message").innerHTML="zu wenig Zahlen",!1;comp=!0;var r=0;do setting(),r++,e=solved();while(!e&&!unloesbar&&2e4>r);return e}function backtrack_user(){0!=backIndex&&(locked[xCur][yCur]||solved()||(hilfebuttons_bgweiss(),sol[xCur][yCur]=" ",backIndex--,xCur=getcol(back[backIndex]),yCur=getrow(back[backIndex]),xNew=xCur,yNew=yCur,zeichne()))}function backtrack(){var e,r,o=!1;if(0!=backIndex){if(locked[xCur][yCur])return unloesbar=!0,void 0;if(sol[xCur][yCur]=" ",count(xCur,yCur)>0){var t=0;do forbidden[xCur][yCur][t]||(o=setvalue(xCur,yCur,String.fromCharCode(49+t))),t++;while(9>t&&!o)}if(!o)do{if(e=xCur,r=yCur,backIndex--,xCur=getcol(back[backIndex]),yCur=getrow(back[backIndex]),locked[xCur][yCur])return unloesbar=!0,void 0;if(e!=xCur||r!=yCur)for(t=0;9>t;t++)forbidden[e][r][t]=!1;sol[xCur][yCur]=" "}while(!possible_move()||unloesbar)}}function save(){for(var e=0;9>e;e++)for(var r=0;9>r;r++)savesol[e][r]=sol[e][r]}function load(){initPuzzle();for(var e=0;9>e;e++)for(var r=0;9>r;r++)locked[e][r]=setvalue(e,r,savesol[e][r])}function save_user(){for(var e=0;9>e;e++)for(var r=0;9>r;r++)locked[e][r]?(saveuser[e][r][0]=sol[e][r],saveuser[e][r][1]=" "):(saveuser[e][r][0]=" ",saveuser[e][r][1]=sol[e][r])}function load_user(){initPuzzle();for(var e=0;9>e;e++)for(var r=0;9>r;r++)" "!=saveuser[e][r][0]&&(locked[e][r]=setvalue(e,r,saveuser[e][r][0]))," "!=saveuser[e][r][1]&&setvalue(e,r,saveuser[e][r][1]);zeichne()}function getInfo(){document.getElementById("Verf").innerHTML=help?possibilities(xNew,yNew):"           "}function rand(e){return Math.floor(Math.random()*e)}function line(e,r,o,t){ctx.moveTo(e,r),ctx.lineTo(o,t)}function getMousePos(e,r){var o=e.getBoundingClientRect();return{x:r.clientX-o.left,y:r.clientY-o.top}}function deaktiviere_zifferbuttons(){for(var e=1;10>e;e++)document.getElementById(String.fromCharCode(e+48)).disabled=!0}function aktiviere_zifferbuttons(){for(var e=1;10>e;e++)document.getElementById(String.fromCharCode(e+48)).disabled=!1}function deaktiviere_hilfebuttons(){for(var e=1;10>e;e++)document.getElementById("H"+String.fromCharCode(e+48)).disabled=!0,document.getElementById("H"+e).style.backgroundColor="white"}function aktiviere_hilfebuttons(){for(var e=1;10>e;e++)document.getElementById("H"+String.fromCharCode(e+48)).disabled=!1}function hilfebuttons_bgweiss(){for(var e=1;10>e;e++)document.getElementById("H"+e).style.backgroundColor="white"}for(var W,H,cellw,backIndex,sol=new Array(9),i=0;9>i;i++)sol[i]=new Array(9);var locked=new Array(9);for(i=0;9>i;i++)locked[i]=new Array(9);var help1=new Array(9);for(i=0;9>i;i++)help1[i]=new Array(9);var prob=new Array(9);for(i=0;9>i;i++)prob[i]=new Array(9);var savesol=new Array(9);for(i=0;9>i;i++)savesol[i]=new Array(9);var saveuser=new Array(9);for(i=0;9>i;i++){saveuser[i]=new Array(9);for(var j=0;9>j;j++)saveuser[i][j]=new Array(2)}var forbidden=new Array(9);for(i=0;9>i;i++)for(forbidden[i]=new Array(9),j=0;9>j;j++)forbidden[i][j]=new Array(9);var back=new Array(500),xCur=0,yCur=0,xNew=0,yNew=0,create=!1,comp,unloesbar,help,ctx,canvas1,initmade=!1;